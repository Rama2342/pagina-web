<!DOCTYPE html>

<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Colegio San Isidro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/futuristic.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="app-container">
        <nav class="glass-nav">
            <div class="nav-brand">
                <img src="assets/images/San Isidro- Escudo_insignia.jpg" alt="San Isidro Logo" style="height:48px;vertical-align:middle;margin-right:12px;">
                <h1 data-text="San Isidro" style="font-family:'Montserrat',sans-serif;font-weight:700;display:inline-block;vertical-align:middle;">San Isidro</h1>
                <span class="nav-subtitle" style="font-family:'Montserrat',sans-serif;font-weight:700;">COLEGIO PRIVADO</span>
            </div>
            <div class="nav-links">
                <a href="#" class="nav-link active"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                <a href="#" class="nav-link"><i class="fas fa-book"></i> Cursos</a>
                <a href="#" class="nav-link"><i class="fas fa-calendar"></i> Calendario</a>
                <a href="#" class="nav-link"><i class="fas fa-chart-bar"></i> Calificaciones</a>
                <a href="#" id="logoutButton" class="nav-link"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a>
            </div>
        </nav>

        <main class="dashboard-container">
            <!-- Header con Reloj y Bienvenida -->
            <div class="dashboard-header">
                <div class="header-left">
                    <h1>Panel de Control</h1>
                    <p id="welcomeMessage">Bienvenido al Sistema de Gestión Escolar</p>
                    <div class="user-info">
                        <span id="userRole">Estudiante</span>
                        <span>•</span>
                        <span id="userGrade">4° Año - Ciencias Sociales</span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="live-clock">
                        <div class="time" id="currentTime">00:00:00</div>
                        <div class="date" id="currentDate">Lunes, 1 de Enero de 2024</div>
                    </div>
                </div>
            </div>

            <!-- Estadísticas Principales -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-value" id="statAverage">8.7</div>
                    <div class="stat-label">Promedio General</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up"></i> +2.5% este mes
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-value" id="statAttendance">94%</div>
                    <div class="stat-label">Asistencia</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up"></i> +3% esta semana
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="stat-value" id="statSubjects">12</div>
                    <div class="stat-label">Materias Activas</div>
                    <div class="stat-trend">
                        <i class="fas fa-minus"></i> Sin cambios
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <div class="stat-value" id="statAssignments">5</div>
                    <div class="stat-label">Tareas Pendientes</div>
                    <div class="stat-trend trend-down">
                        <i class="fas fa-arrow-down"></i> -2 desde ayer
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <!-- Columna Izquierda - Información del Usuario -->
                <div class="dashboard-column">
                    <!-- Tarjeta de Información Personal -->
                    <div class="glass-card user-card">
                        <div class="card-header">
                            <h3><i class="fas fa-user"></i> Información Personal</h3>
                        </div>
                        <div class="user-details">
                            <div class="user-avatar">
                                <i class="fas fa-user-graduate"></i>
                            </div>
                            <div class="user-info-details">
                                <p><strong>Nombre:</strong> <span id="userName">Cargando...</span></p>
                                <p><strong>Email:</strong> <span id="userEmail">Cargando...</span></p>
                                <p><strong>Matrícula:</strong> <span id="userCode">Cargando...</span></p>
                                <p><strong>Curso:</strong> <span id="userCourse">Cargando...</span></p>
                                <p><strong>Turno:</strong> <span id="userTurn">Cargando...</span></p>
                                <p><strong>Estado:</strong> <span id="userStatus">Cargando...</span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Tarjeta de Progreso Académico -->
                    <div class="glass-card performance-card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-pie"></i> Distribución de Calificaciones</h3>
                        </div>
                        <div class="performance-stats">
                            <div class="performance-item">
                                <div class="performance-label">Excelente (9-10)</div>
                                <div class="performance-progress">
                                    <div class="progress-bar" style="width: 45%"></div>
                                </div>
                                <div class="performance-value">45%</div>
                            </div>
                            <div class="performance-item">
                                <div class="performance-label">Bueno (7-8.9)</div>
                                <div class="performance-progress">
                                    <div class="progress-bar" style="width: 35%"></div>
                                </div>
                                <div class="performance-value">35%</div>
                            </div>
                            <div class="performance-item">
                                <div class="performance-label">Regular (6-6.9)</div>
                                <div class="performance-progress">
                                    <div class="progress-bar" style="width: 15%"></div>
                                </div>
                                <div class="performance-value">15%</div>
                            </div>
                            <div class="performance-item">
                                <div class="performance-label">Bajo (<6)</div>
                                <div class="performance-progress">
                                    <div class="progress-bar" style="width: 5%"></div>
                                </div>
                                <div class="performance-value">5%</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Columna Central - Calificaciones y Actividades -->
                <div class="dashboard-column">
                    <!-- Últimas Calificaciones -->
                    <div class="glass-card">
                        <div class="card-header">
                            <h3><i class="fas fa-graduation-cap"></i> Últimas Calificaciones</h3>
                            <a href="#" class="view-all">Ver todas</a>
                        </div>
                        <div class="grades-table-container">
                            <table class="grades-table">
                                <thead>
                                    <tr>
                                        <th>Materia</th>
                                        <th>Calificación</th>
                                        <th>Fecha</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Matemáticas</td>
                                        <td>9.5</td>
                                        <td>25/08</td>
                                        <td><span class="grade-badge grade-excellent">Excelente</span></td>
                                    </tr>
                                    <tr>
                                        <td>Historia</td>
                                        <td>8.2</td>
                                        <td>24/08</td>
                                        <td><span class="grade-badge grade-good">Bueno</span></td>
                                    </tr>
                                    <tr>
                                        <td>Física</td>
                                        <td>7.8</td>
                                        <td>23/08</td>
                                        <td><span class="grade-badge grade-good">Bueno</span></td>
                                    </tr>
                                    <tr>
                                        <td>Química</td>
                                        <td>6.5</td>
                                        <td>22/08</td>
                                        <td><span class="grade-badge grade-average">Regular</span></td>
                                    </tr>
                                    <tr>
                                        <td>Literatura</td>
                                        <td>9.0</td>
                                        <td>21/08</td>
                                        <td><span class="grade-badge grade-excellent">Excelente</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Próximas Actividades -->
                    <div class="glass-card activities-card">
                        <div class="card-header">
                            <h3><i class="fas fa-tasks"></i> Próximas Actividades</h3>
                        </div>
                        <div class="activities-list" id="upcomingActivities">
                            <!-- Las actividades se cargarán dinámicamente -->
                        </div>
                    </div>
                </div>

                <!-- Columna Derecha - Acciones y Noticias -->
                <div class="dashboard-column">
                    <!-- Acciones Rápidas -->
                    <div class="glass-card">
                        <div class="card-header">
                            <h3><i class="fas fa-bolt"></i> Acciones Rápidas</h3>
                        </div>
                        <div class="quick-actions">
                            <a href="#" class="action-btn">
                                <div class="action-icon">
                                    <i class="fas fa-chart-bar"></i>
                                </div>
                                <span class="action-text">Ver Calificaciones</span>
                            </a>
                            <a href="#" class="action-btn">
                                <div class="action-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <span class="action-text">Mi Horario</span>
                            </a>
                            <a href="#" class="action-btn">
                                <div class="action-icon">
                                    <i class="fas fa-book"></i>
                                </div>
                                <span class="action-text">Materiales</span>
                            </a>
                            <a href="#" class="action-btn">
                                <div class="action-icon">
                                    <i class="fas fa-envelope"></i>
                                </div>
                                <span class="action-text">Mensajes</span>
                            </a>
                            <a href="#" class="action-btn">
                                <div class="action-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <span class="action-text">Asistencia</span>
                            </a>
                            <a href="#" class="action-btn">
                                <div class="action-icon">
                                    <i class="fas fa-calendar"></i>
                                </div>
                                <span class="action-text">Eventos</span>
                            </a>
                        </div>
                    </div>

                    <!-- Noticias del Colegio -->
                    <div class="glass-card">
                        <div class="card-header">
                            <h3><i class="fas fa-newspaper"></i> Noticias Recientes</h3>
                        </div>
                        <div class="news-list">
                            <div class="news-item">
                                <div class="news-date">28/08/2024</div>
                                <h4>Inicio de Clases 2024</h4>
                                <p>El ciclo lectivo 2024 comienza el 4 de septiembre. ¡Bienvenidos!</p>
                            </div>
                            <div class="news-item">
                                <div class="news-date">25/08/2024</div>
                                <h4>Torneo Deportivo</h4>
                                <p>Inscripciones abiertas para el torneo intercolegial de básquet.</p>
                            </div>
                            <div class="news-item">
                                <div class="news-date">20/08/2024</div>
                                <h4>Conferencia de Orientación</h4>
                                <p>Charla informativa sobre carreras universitarias para alumnos de 6° año.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Estado del Sistema -->
                    <div class="glass-card system-card">
                        <div class="card-header">
                            <h3><i class="fas fa-server"></i> Estado del Sistema</h3>
                        </div>
                        <div class="system-status">
                            <div class="status-item online">
                                <i class="fas fa-circle"></i>
                                <span>Sistema Académico</span>
                            </div>
                            <div class="status-item online">
                                <i class="fas fa-circle"></i>
                                <span>Base de Datos</span>
                            </div>
                            <div class="status-item online">
                                <i class="fas fa-circle"></i>
                                <span>Comunicaciones</span>
                            </div>
                            <div class="status-item">
                                <i class="fas fa-sync-alt"></i>
                                <span>Última actualización: <span id="lastUpdate">--:--</span></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="glass-footer">
            <div class="footer-content">
                <div class="footer-section">
                    <p><i class="fas fa-clock"></i> Último acceso: <span id="lastAccess">--:--</span></p>
                </div>
                <div class="footer-section">
                    <p>Colegio San Isidro - Sistema de Gestión Escolar</p>
                </div>
                <div class="footer-section">
                    <p><i class="fas fa-user"></i> <span id="footerUser">Usuario</span></p>
                </div>
            </div>
        </footer>
    </div>

    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/dashboard.js"></script>
    
    <script>
        // Inicialización del dashboard
        document.addEventListener('DOMContentLoaded', function() {
            if (!auth.isAuthenticated()) {
                window.location.href = '/login.html';
                return;
            }

            // Cargar datos del usuario
            loadUserData();
            
            // Iniciar reloj en tiempo real
            startRealTimeClock();
            
            // Cargar actividades
            loadActivities();
            
            // Configurar eventos
            setupDashboardEvents();
            
            // Actualizar última conexión
            updateLastAccess();
        });

        async function loadUserData() {
            try {
                const response = await fetch(`${auth.apiBase}/user/full-profile`, {
                    headers: auth.getAuthHeaders()
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        updateUserInterface(data.user);
                    }
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                // Usar datos guardados como fallback
                const savedData = localStorage.getItem('userData');
                if (savedData) {
                    updateUserInterface(JSON.parse(savedData));
                }
            }
        }

        function updateUserInterface(userData) {
            // Información personal
            document.getElementById('userName').textContent = userData.nombre || userData.username;
            document.getElementById('userEmail').textContent = userData.email;
            document.getElementById('userCode').textContent = userData.matricula;
            document.getElementById('userCourse').textContent = `${userData.grado} ${userData.seccion}`;
            document.getElementById('userTurn').textContent = userData.turno;
            document.getElementById('userStatus').textContent = userData.estado;
            
            // Header
            document.getElementById('welcomeMessage').textContent = `Bienvenido, ${userData.nombre || userData.username}`;
            document.getElementById('userRole').textContent = userData.is_admin ? 'Administrador' : 'Estudiante';
            document.getElementById('userGrade').textContent = `${userData.grado} ${userData.especialidad || ''}`;
            document.getElementById('footerUser').textContent = userData.nombre || userData.username;
        }

        function startRealTimeClock() {
            function updateClock() {
                const now = new Date();
                document.getElementById('currentTime').textContent = now.toLocaleTimeString('es-ES');
                document.getElementById('currentDate').textContent = now.toLocaleDateString('es-ES', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                document.getElementById('lastUpdate').textContent = now.toLocaleTimeString('es-ES');
            }
            
            updateClock();
            setInterval(updateClock, 1000);
        }

        function loadActivities() {
            const activities = [
                {
                    type: 'exam',
                    title: 'Examen de Matemáticas',
                    description: 'Unidad 3 - Álgebra y Cálculo',
                    time: 'Hoy - 10:00 AM',
                    urgent: true
                },
                {
                    type: 'assignment',
                    title: 'Entrega de Historia',
                    description: 'Revolución Industrial - Ensayo',
                    time: 'Mañana - 2:00 PM',
                    important: true
                },
                {
                    type: 'event',
                    title: 'Olimpíadas de Ciencias',
                    description: 'Fase regional - Preparación',
                    time: '15/09 - 9:00 AM'
                }
            ];

            const activitiesList = document.getElementById('upcomingActivities');
            activitiesList.innerHTML = '';

            activities.forEach(activity => {
                const activityItem = document.createElement('div');
                activityItem.className = 'activity-item';
                
                if (activity.urgent) activityItem.classList.add('urgent');
                if (activity.important) activityItem.classList.add('important');
                
                let icon = '📚';
                if (activity.type === 'assignment') icon = '📝';
                if (activity.type === 'event') icon = '🎯';
                
                activityItem.innerHTML = `
                    <div class="activity-icon">${icon}</div>
                    <div class="activity-content">
                        <h4>${activity.title}</h4>
                        <p>${activity.description}</p>
                        <span class="activity-time">${activity.time}</span>
                    </div>
                `;
                
                activitiesList.appendChild(activityItem);
            });
        }

        function setupDashboardEvents() {
            // Logout
            document.getElementById('logoutButton').addEventListener('click', function(e) {
                e.preventDefault();
                if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
                    auth.logout();
                }
            });

            // Acciones rápidas
            document.querySelectorAll('.action-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const action = this.querySelector('.action-text').textContent;
                    showNotification(`Accediendo a: ${action}`, 'info');
                });
            });
        }

        function updateLastAccess() {
            document.getElementById('lastAccess').textContent = new Date().toLocaleString('es-ES');
        }

        function showNotification(message, type = 'info') {
            // Tu función de notificaciones existente
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <span class="notification-message">${message}</span>
                    <button class="notification-close">×</button>
                </div>
            `;
            
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 10px;
                padding: 15px;
                color: white;
                z-index: 10000;
                max-width: 300px;
                animation: slideIn 0.3s ease;
            `;
            
            document.body.appendChild(notification);
            
            // Configurar cierre
            notification.querySelector('.notification-close').addEventListener('click', function() {
                notification.remove();
            });
            
            // Auto-eliminar
            setTimeout(() => notification.remove(), 5000);
    }

    // Exportar la función para uso global
    window.showNotification = showNotification;
    </script>
</body>
</html>